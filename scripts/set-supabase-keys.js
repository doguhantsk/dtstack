#!/usr/bin/env node
// Usage:
// SUPABASE_URL=... SUPABASE_ANON_KEY=... node scripts/set-supabase-keys.js
// This writes `assets/supabase.js` with the provided values.

const fs = require('fs');
const path = require('path');

const url = process.env.SUPABASE_URL;
const key = process.env.SUPABASE_ANON_KEY;

if (!url || !key) {
  console.error('Error: Please set SUPABASE_URL and SUPABASE_ANON_KEY environment variables.');
  console.error('Example: SUPABASE_URL=https://... SUPABASE_ANON_KEY=ey... node scripts/set-supabase-keys.js');
  process.exit(1);
}

const target = path.join(__dirname, '..', 'assets', 'supabase.js');

const content = `// Generated by scripts/set-supabase-keys.js - do not commit this file with real keys to VCS
const SUPABASE_URL = '${url}';
const SUPABASE_ANON_KEY = '${key}';

if (!globalThis.supabase || typeof globalThis.supabase.createClient !== 'function') {
  console.error('Supabase JS not loaded. Ensure CDN script is loaded before this module.');
}

const supabaseClient = globalThis.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
export const supabase = supabaseClient;
globalThis._supabase = supabaseClient;
`;

fs.writeFileSync(target, content, { encoding: 'utf8' });
console.log('Wrote', target);
